<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>EQRng.com — Random Zone</title>
        <style>
            body {
                font-family: sans-serif;
                max-width: 600px;
                margin: 2em auto;
            }
            img {
                max-width: 100%;
                border: 1px solid #ccc;
                margin-top: 1em;
            }
            .zone-data li {
                margin-bottom: 0.5em;
            }
            label {
                display: block;
                margin-top: 1em;
            }
        </style>
        <!-- Standard favicon link -->
        <link rel="icon" href="assets/images/eq_rng.ico" type="image/x-icon" />
        <!-- Legacy support for IE -->
        <link
            rel="shortcut icon"
            href="assets/images/eq_rng.ico"
            type="image/x-icon"
        />
        <!-- (Optional) PNG fallback -->
        <link rel="icon" href="assets/images/eq_rng.png" type="image/png" />
    </head>
    <body>
        <div id="section">
            <h1>Random EverQuest Zone</h1>
            <!-- <label>
                Min Level:
                <input type="number" id="min" value="-1" min="1" max="125" />
            </label>
            <label>
                Max Level:
                <input type="number" id="max" value="-1" min="1" max="125" />
            </label> -->

            <label>
              Min Level:
              <select id="min"></select>
            </label>
            <label>
              Max Level:
              <select id="max"></select>
            </label>

            <script>
              // populate both min and max selects with "Any" + 1..125
              ['min','max'].forEach(id => {
                const sel = document.getElementById(id);
                sel.innerHTML = '<option value="">Any</option>';
                for (let i = 1; i <= 125; i++) {
                  const opt = document.createElement('option');
                  opt.value = i;
                  opt.textContent = i;
                  sel.appendChild(opt);
                }
              });

              // …then the rest of your existing handlers go here…
              document.getElementById("go-zone").onclick = async () => {
                const min = document.getElementById("min").value;
                const max = document.getElementById("max").value;
                // …etc…
              };
              // etc.
            </script>



            <label>
                Type:
                <select id="zone-type">
                    <option value="">Any</option>
                    <option>Outdoor</option>
                    <option>Dungeon</option>
                    <option>City</option>
                    <option>Raid</option>
                    <option>Indoor</option>
                </select>
            </label>
            <label>
                Expansion:
                <select id="expansion">
                    <option value="">Any</option>
                    <option>Classic</option>
                    <option>The Ruins of Kunark</option>
                    <option>The Scars of Velious</option>
                    <option>The Shadows of Luclin</option>
                    <option>The Planes of Power</option>
                    <option>The Legacy of Ykesha</option>
                    <option>Lost Dungeons of Norrath</option>
                    <option>Gates of Discord</option>
                    <option>Omens of War</option>
                    <option>Dragons of Norrath</option>
                    <option>Depths of Darkhollow</option>
                    <option>Prophecy of Ro</option>
                    <option>The Serpent's Spine</option>
                    <option>The Buried Sea</option>
                    <option>Secrets of Faydwer</option>
                    <option>Seeds of Destruction</option>
                    <option>Underfoot</option>
                    <option>House of Thule</option>
                    <option>Veil of Alaris</option>
                    <option>Rain of Fear</option>
                    <option>Call of the Forsaken</option>
                    <option>The Darkened Sea</option>
                    <option>The Broken Mirror</option>
                    <option>Empires of Kunark</option>
                    <option>Ring of Scale</option>
                    <option>The Burning Lands</option>
                    <option>Torment of Velious</option>
                    <option>Claws of Veeshan</option>
                    <option>Terror of Luclin</option>
                    <option>Night of Shadows</option>
                    <option>Laurion's Song</option>
                    <option>The Outer Brood</option>
                </select>
            </label>

            <label>
                Mission Zones:
                <select id="mission">
                    <option value="">Any</option>
                    <option value="true">Only Mission Zones</option>
                    <option value="false">Exclude Mission Zones</option>
                </select>
            </label>

            <button id="go-zone">Get Random Zone</button>

            <div id="result" style="margin-top: 2em"></div>
        </div>

        <!-- Random Race Section -->
        <div class="section">
            <h2>Random Race</h2>
            <button id="go-race">Get Random Race</button>

            <div id="race-result" style="margin-top: 1em"></div>
        </div>

        <!-- Random Class Section -->
        <div class="section">
            <h2>Random Class</h2>
            <label>
                Optional Race Filter:
                <input type="text" id="class-race" />
            </label>
            <button id="go-class">Get Random Class</button>
            <div id="class-result" style="margin-top: 1em"></div>
        </div>

        <script>
            document.getElementById("go-zone").onclick = async () => {
                const min = document.getElementById("min").value;
                const max = document.getElementById("max").value;
                const zt = document.getElementById("zone-type").value;
                const exp = document.getElementById("expansion").value;
                const mission = document.getElementById("mission").value;

                const params = new URLSearchParams();

                // only set if non‐empty
                if (min)     params.set("min",      min);
                if (max)     params.set("max",      max);
                if (zt)      params.set("zone_type",zt);
                if (exp)     params.set("expansion",exp);
                if (mission) params.set("mission",  mission);

                const res = await fetch(`/random_zone?${params}`);
                const out = document.getElementById("result");

                if (!res.ok) {
                  out.textContent = "No zone found.";
                  return;
                }

                const z = await res.json();
                out.innerHTML = `
                  <h2>${z.name}</h2>
                  <ul class="zone-data">
                    <li><strong>Levels:</strong> ${z.level_ranges.map(r => r.join("–")).join(", ")}</li>
                    <li><strong>Expansion:</strong> ${z.expansion}</li>
                    <li><strong>Continent:</strong> ${z.continent}</li>
                    <li><strong>Type:</strong> ${z.zone_type}</li>
                    <li><strong>Mission Zone?:</strong> ${z.mission ? "Yes" : "No"}</li>
                    <li><strong>Hot Zone?:</strong> ${z.hot_zone ? "Yes" : "No"}</li>
                    <li><strong>Connections:</strong> ${z.connections.join(", ")}</li>
                  </ul>
                  <img src="${z.image_url}" alt="Zone image">
                  <img src="${z.map_url}" alt="Zone map">
                `;
              };

            document.getElementById("go-race").onclick = async () => {
                const res = await fetch("/random_race");
                const out = document.getElementById("race-result");
                const class_out = document.getElementById("class-race");

                if (!res.ok) {
                    out.textContent = "Error fetching race.";
                    return;
                }

                const race = await res.json();
                out.innerHTML = `<h3>${race}</h3>`;
                class_out.value = race;
            };

            document.getElementById("go-class").onclick = async () => {
                const race = document.getElementById("class-race").value;
                const params = new URLSearchParams();
                if (race) params.set("race", race);

                const res = await fetch(`/random_class?${params}`);
                const out = document.getElementById("class-result");

                if (!res.ok) {
                    out.textContent = "Error fetching class.";
                    return;
                }

                const result = await res.json();
                out.innerHTML = result
                    ? `<h3>${result}</h3>`
                    : `<p>No class available for that race.</p>`;
            };

            window.addEventListener("DOMContentLoaded", async () => {
              try {
                const res = await fetch("/version");
                if (!res.ok) throw new Error("no version");
                const { version } = await res.json();
                document.getElementById("app-version").textContent = version;
              } catch {
                document.getElementById("app-version").textContent = "n/a";
              }
            });
        </script>

        <footer style="text-align:center; margin-top:2em;">
          Version: <span id="app-version">…</span>
        </footer>
    </body>
</html>
